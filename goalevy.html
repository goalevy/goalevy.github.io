<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2113.65">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1">&lt;meta charset="utf-8" /&gt;</p>
<p class="p1">&lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;</p>
<p class="p1">&lt;title&gt;Steps — Staircase Tracker&lt;/title&gt;</p>
<p class="p1">&lt;meta name="description" content="Track progress as literal stairs. Finite goals show remaining steps in grey; infinite goals grow with each day you log." /&gt;</p>
<p class="p1">&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">    </span>--bg:#0f1014; --fg:#f7f8fb; --muted:#a6adbb; --card:#161821; --line:#242736;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--accent:#7a7cff; --accent-2:#ff5fa2; --good:#39d98a; --warn:#ffb020; --danger:#ff6b6b;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--grey:#3b3f55; --radius:14px; --shadow: 0 10px 28px rgba(0,0,0,.35);</p>
<p class="p1"><span class="Apple-converted-space">    </span>--max:1200px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>@media (prefers-color-scheme: light){</p>
<p class="p1"><span class="Apple-converted-space">    </span>:root{ --bg:#ffffff; --fg:#12131a; --muted:#5d6372; --card:#f3f5f8; --line:#e7e9ef; --grey:#c9cdd8; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>*{ box-sizing:border-box }</p>
<p class="p1"><span class="Apple-converted-space">  </span>html,body{ height:100% }</p>
<p class="p1"><span class="Apple-converted-space">  </span>body{</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color:var(--fg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>background:</p>
<p class="p1"><span class="Apple-converted-space">      </span>radial-gradient(900px 500px at 85% -10%, color-mix(in oklab, var(--accent) 10%, transparent), transparent 60%),</p>
<p class="p1"><span class="Apple-converted-space">      </span>radial-gradient(700px 500px at -10% 20%, color-mix(in oklab, var(--accent-2) 10%, transparent), transparent 60%),</p>
<p class="p1"><span class="Apple-converted-space">      </span>var(--bg);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.wrap{ max-width:var(--max); margin-inline:auto; padding: clamp(14px, 2.5vw, 28px) }</p>
<p class="p1"><span class="Apple-converted-space">  </span>header{</p>
<p class="p1"><span class="Apple-converted-space">    </span>position:sticky; top:0; z-index:10; backdrop-filter:saturate(160%) blur(8px);</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: color-mix(in oklab, var(--bg) 88%, transparent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-bottom:1px solid color-mix(in oklab, var(--fg) 10%, transparent);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.topbar{ display:flex; align-items:center; justify-content:space-between; gap:12px }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.brand{ font-weight:700; letter-spacing:.2px }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.btn{</p>
<p class="p1"><span class="Apple-converted-space">    </span>appearance:none; border:none; cursor:pointer; font:inherit; color:white;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background:linear-gradient(135deg, var(--accent), var(--accent-2));</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding:10px 14px; border-radius:999px; box-shadow:var(--shadow);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.btn.ghost{ background:transparent; color:var(--fg); border:1px solid color-mix(in oklab, var(--fg) 18%, transparent) }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.btn.danger{ background: var(--danger) }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.btn.small{ padding:7px 10px; font-size:14px }</p>
<p class="p1"><span class="Apple-converted-space">  </span>select, input[type="text"], input[type="number"], textarea{</p>
<p class="p1"><span class="Apple-converted-space">    </span>width:100%; padding:10px 12px; border-radius:12px; border:1px solid color-mix(in oklab, var(--fg) 16%, transparent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>background:#0000; color:var(--fg);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>textarea{ min-height:76px; resize:vertical }</p>
<p class="p1"><span class="Apple-converted-space">  </span>main{ display:grid; grid-template-columns: 310px 1fr; gap:20px; margin-top:18px }</p>
<p class="p1"><span class="Apple-converted-space">  </span>@media (max-width: 980px){ main{ grid-template-columns:1fr } }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.panel{ background:var(--card); border:1px solid var(--line); border-radius: var(--radius); padding:16px }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.panel h3{ margin:.2rem 0 1rem; font-size:18px }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.list{ display:grid; gap:10px; max-height:60vh; overflow:auto; padding-right:6px }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.goal-item{ display:flex; align-items:center; gap:10px; padding:10px; border:1px solid var(--line); border-radius:12px; cursor:pointer; background:#0000 }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.goal-item.active{ outline: 2px solid color-mix(in oklab, var(--accent) 60%, transparent) }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.type-pill{ font-size:12px; padding:4px 8px; border-radius:999px; background: color-mix(in oklab, var(--fg) 10%, transparent); color:var(--muted) }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.muted{ color:var(--muted) }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.stats{ display:flex; gap:14px; flex-wrap:wrap; margin:6px 0 12px }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.stat{ background: color-mix(in oklab, var(--fg) 8%, transparent); border:1px solid color-mix(in oklab, var(--fg) 12%, transparent); padding:10px 12px; border-radius:10px; font-size:14px }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.divider{ height:1px; background:var(--line); margin:14px 0 }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.empty{ padding:18px; border:1px dashed var(--line); border-radius:12px; text-align:center; color:var(--muted) }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.kpi{ font-weight:600 } .mono{ font-variant-numeric: tabular-nums }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.stairwrap{ position:relative; min-height:420px; width:100%; border-radius:12px; overflow:auto; background: color-mix(in oklab, var(--fg) 3%, transparent); border:1px dashed color-mix(in oklab, var(--fg) 10%, transparent); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.tile{</p>
<p class="p1"><span class="Apple-converted-space">    </span>position:absolute; display:flex; align-items:center; justify-content:center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>width:50px; height:50px; border-radius:10px; user-select:none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--grey); color:#ffffffcc; border:1px dashed color-mix(in oklab, var(--fg) 14%, transparent);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.tile.done{</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: linear-gradient(145deg, color-mix(in oklab, var(--accent) 35%, #0000), color-mix(in oklab, var(--accent-2) 35%, #0000));</p>
<p class="p1"><span class="Apple-converted-space">    </span>border:1px solid color-mix(in oklab, var(--fg) 20%, transparent);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.tile .label{</p>
<p class="p1"><span class="Apple-converted-space">    </span>position:absolute; bottom:4px; left:6px; right:6px; font-size:10px; opacity:.9; text-align:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.tile button{ all:unset; position:absolute; inset:0; cursor:pointer }</p>
<p class="p1"><span class="Apple-converted-space">  </span>dialog{ border:none; border-radius:16px; padding:0; max-width:520px; width:min(92vw, 560px); color:var(--fg); background:var(--card);</p>
<p class="p1"><span class="Apple-converted-space">          </span>box-shadow: var(--shadow); border:1px solid var(--line); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>dialog::backdrop{ background:rgba(0,0,0,.45) }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.modal-body{ padding:18px } .modal-actions{ display:flex; justify-content:flex-end; gap:10px; padding:0 18px 18px }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.sr-only{ position:absolute; width:1px; height:1px; margin:-1px; padding:0; overflow:hidden; clip:rect(0,0,0,0); border:0 }</p>
<p class="p1"><span class="Apple-converted-space">  </span>.footer{ margin-top:22px; color:var(--muted); font-size:12px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap }</p>
<p class="p1">&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1">&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="wrap topbar"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="brand"&gt;Steps&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="muted mono" id="todayLabel" aria-live="polite"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn small" id="newGoalBtn"&gt;New goal&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn ghost small" id="exportBtn" title="Export JSON"&gt;Export&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;label class="btn ghost small" for="importFile" title="Import JSON"&gt;Import&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;input id="importFile" type="file" accept="application/json" class="sr-only" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p1">&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;div class="wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;main&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Left: goals --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;aside class="panel" aria-label="Goals"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h3&gt;Your goals&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div id="goalList" class="list" role="list"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="divider"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="footer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;span&gt;Total goals: &lt;span id="goalCount" class="mono"&gt;0&lt;/span&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="btn ghost small" id="clearAllBtn"&gt;Reset all&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/aside&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Right: details --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;section class="panel" aria-live="polite" id="detailPanel"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="row" style="justify-content:space-between"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h3 id="goalTitle"&gt;No goal selected&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;button class="btn small" id="logTodayBtn" disabled&gt;Log today&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;button class="btn ghost small" id="editGoalBtn" disabled&gt;Edit&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;button class="btn danger small" id="deleteGoalBtn" disabled&gt;Delete&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p class="muted" id="goalMeta"&gt;&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="stats" id="statsBar" hidden&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;span class="stat"&gt;Progress: &lt;span class="kpi mono" id="progressPct"&gt;0%&lt;/span&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;span class="stat"&gt;Done: &lt;span class="kpi mono" id="doneCount"&gt;0&lt;/span&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;span class="stat" id="totalWrap"&gt;Total: &lt;span class="kpi mono" id="totalCount"&gt;0&lt;/span&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;span class="stat" title="Consecutive days with entries"&gt;Streak: &lt;span class="kpi mono" id="streakCount"&gt;0&lt;/span&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;span class="stat"&gt;First: &lt;span class="kpi mono" id="firstDate"&gt;—&lt;/span&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;span class="stat"&gt;Latest: &lt;span class="kpi mono" id="latestDate"&gt;—&lt;/span&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="divider"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div id="gridWrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="empty"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>Select or create a goal. Finite goals show remaining stairs in grey. <span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>No-end goals grow a new stair each day you log.</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/section&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/main&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;!-- New/Edit goal modal --&gt;</p>
<p class="p1">&lt;dialog id="goalDialog" aria-labelledby="goalDialogTitle"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;form method="dialog" id="goalForm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="modal-body"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h3 id="goalDialogTitle"&gt;Create goal&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="row" style="margin-top:8px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label class="type-pill"&gt;&lt;input type="radio" name="type" value="finite" checked /&gt; Visible end goal&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label class="type-pill"&gt;&lt;input type="radio" name="type" value="infinite" /&gt; No end goal&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div style="margin-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label&gt;Goal name</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input type="text" name="name" placeholder="e.g. Walk 7,500" required /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div id="totalRow" style="margin-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label&gt;Total stairs (how many to achieve)</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input type="number" name="total" min="1" step="1" placeholder="e.g. 100" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p class="muted" style="font-size:12px;margin:.4rem 0 0"&gt;Remaining stairs render in grey.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="modal-actions"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn ghost" value="cancel"&gt;Cancel&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn" value="ok"&gt;Save&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/form&gt;</p>
<p class="p1">&lt;/dialog&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;!-- Log note modal --&gt;</p>
<p class="p1">&lt;dialog id="noteDialog" aria-labelledby="noteTitle"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;form method="dialog" id="noteForm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="modal-body"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h3 id="noteTitle"&gt;Today’s step&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p class="muted"&gt;Date: &lt;span id="noteDate"&gt;&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;label&gt;What did you do today?</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;textarea name="note" placeholder="Short note for today’s stair…"&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="modal-actions"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn ghost" value="cancel"&gt;Cancel&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn" value="ok"&gt;Save&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/form&gt;</p>
<p class="p1">&lt;/dialog&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;!-- View/Edit entry modal --&gt;</p>
<p class="p1">&lt;dialog id="entryDialog" aria-labelledby="entryTitle"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;form method="dialog" id="entryForm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="modal-body"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h3 id="entryTitle"&gt;Entry&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p class="muted"&gt;Date: &lt;span id="entryDate"&gt;&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;label&gt;Note</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;textarea name="note"&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="modal-actions"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn danger" id="deleteEntryBtn" value="delete"&gt;Delete&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn ghost" value="cancel"&gt;Close&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn" value="ok"&gt;Save&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/form&gt;</p>
<p class="p1">&lt;/dialog&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">/* ========= Utilities ========= */</p>
<p class="p1">const $ = s =&gt; document.querySelector(s);</p>
<p class="p1">const $$ = s =&gt; Array.from(document.querySelectorAll(s));</p>
<p class="p1">const uid = () =&gt; (crypto &amp;&amp; crypto.randomUUID) ? crypto.randomUUID() : 'id-' + Math.random().toString(36).slice(2);</p>
<p class="p1">const todayLocalISO = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const d = new Date();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const y = d.getFullYear();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const m = String(d.getMonth()+1).padStart(2,'0');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const da = String(d.getDate()).padStart(2,'0');</p>
<p class="p1"><span class="Apple-converted-space">  </span>return `${y}-${m}-${da}`;</p>
<p class="p1">};</p>
<p class="p1">const fmt = (iso) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>try { const d = new Date(iso + 'T00:00:00'); return d.toLocaleDateString(undefined, { year:'numeric', month:'short', day:'numeric', weekday:'short' }); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>catch { return iso; }</p>
<p class="p1">};</p>
<p class="p1">const shortDate = (iso)=&gt; { const d = new Date(iso+'T00:00:00'); return d.toLocaleDateString(undefined, { month:'short', day:'numeric' }); }</p>
<p class="p1">const byDateAsc = (a,b)=&gt; a.date.localeCompare(b.date);</p>
<p class="p2"><br></p>
<p class="p1">/* ========= State ========= */</p>
<p class="p1">const DB_KEY = 'steps.goals.v1';</p>
<p class="p1">let state = { goals: [], activeId: null };</p>
<p class="p1">/** @typedef {{ id:string, name:string, type:'finite'|'infinite', total?:number, entries:{date:string, note?:string, id:string}[], createdAt:string }} Goal */</p>
<p class="p2"><br></p>
<p class="p1">/* ========= Storage ========= */</p>
<p class="p1">function load(){ try{ const raw = localStorage.getItem(DB_KEY); if(raw){ state = JSON.parse(raw); } } catch {} }</p>
<p class="p1">function save(){ localStorage.setItem(DB_KEY, JSON.stringify(state)); }</p>
<p class="p2"><br></p>
<p class="p1">/* ========= Rendering ========= */</p>
<p class="p1">function renderToday(){ $('#todayLabel').textContent = `Today: ${fmt(todayLocalISO())}`; }</p>
<p class="p1">function renderGoals(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const list = $('#goalList'); list.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(state.goals.length === 0){</p>
<p class="p1"><span class="Apple-converted-space">    </span>list.innerHTML = `&lt;div class="empty"&gt;No goals yet. Click &lt;b&gt;New goal&lt;/b&gt; to start.&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">    </span>for(const g of state.goals){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const done = g.entries.length;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const total = g.type==='finite' ? g.total ?? 0 : null;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const pct = total ? Math.min(100, Math.round((done/total)*100)) : null;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const el = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">      </span>el.className = 'goal-item' + (g.id===state.activeId ? ' active' : '');</p>
<p class="p1"><span class="Apple-converted-space">      </span>el.setAttribute('role','listitem');</p>
<p class="p1"><span class="Apple-converted-space">      </span>el.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div style="flex:1; text-align:left"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div style="display:flex; justify-content:space-between; gap:8px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;strong&gt;${escapeHTML(g.name)}&lt;/strong&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;span class="type-pill"&gt;${g.type==='finite' ? 'Visible goal' : 'No end goal'}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="muted mono" style="margin-top:4px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>${g.type==='finite' ? `Progress ${pct ?? 0}% · ${done}/${total}` : `Days logged: ${done}`}</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>el.addEventListener('click', ()=&gt;{ state.activeId = g.id; save(); fullRender(); });</p>
<p class="p1"><span class="Apple-converted-space">      </span>list.appendChild(el);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#goalCount').textContent = String(state.goals.length);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function renderDetail(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const g = state.goals.find(x=&gt;x.id===state.activeId);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const title = $('#goalTitle'), meta = $('#goalMeta'), statsBar = $('#statsBar');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const logBtn = $('#logTodayBtn'), editBtn = $('#editGoalBtn'), delBtn = $('#deleteGoalBtn');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const gridWrap = $('#gridWrap');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!g){</p>
<p class="p1"><span class="Apple-converted-space">    </span>title.textContent = 'No goal selected';</p>
<p class="p1"><span class="Apple-converted-space">    </span>meta.textContent = '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>statsBar.hidden = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>logBtn.disabled = editBtn.disabled = delBtn.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gridWrap.innerHTML = `&lt;div class="empty"&gt;Select or create a goal to see stairs.&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>title.textContent = g.name;</p>
<p class="p1"><span class="Apple-converted-space">  </span>logBtn.disabled = editBtn.disabled = delBtn.disabled = false;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const done = g.entries.length;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const total = g.type==='finite' ? (g.total ?? 0) : null;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const pct = total ? Math.min(100, Math.round((done/total)*100)) : null;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const streak = calcStreak(g.entries.map(e=&gt;e.date));</p>
<p class="p1"><span class="Apple-converted-space">  </span>const first = g.entries.slice().sort(byDateAsc)[0]?.date ?? '—';</p>
<p class="p1"><span class="Apple-converted-space">  </span>const latest = g.entries.slice().sort(byDateAsc).slice(-1)[0]?.date ?? '—';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#progressPct').textContent = total ? `${pct}%` : (done&gt;0 ? '—' : '0%');</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#doneCount').textContent = String(done);</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#totalWrap').style.display = g.type==='finite' ? '' : 'none';</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(total) $('#totalCount').textContent = String(total);</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#streakCount').textContent = String(streak);</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#firstDate').textContent = first==='—' ? '—' : fmt(first);</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#latestDate').textContent = latest==='—' ? '—' : fmt(latest);</p>
<p class="p1"><span class="Apple-converted-space">  </span>statsBar.hidden = false;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>meta.innerHTML = g.type==='finite'</p>
<p class="p1"><span class="Apple-converted-space">    </span>? `&lt;span class="muted"&gt;Visible end goal · Remaining stairs show in grey.&lt;/span&gt;`</p>
<p class="p1"><span class="Apple-converted-space">    </span>: `&lt;span class="muted"&gt;No end goal · Each day you log adds a stair to your history.&lt;/span&gt;`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Build literal staircase</p>
<p class="p1"><span class="Apple-converted-space">  </span>const view = renderStaircase(g.entries, g.total, g.type, g.id);</p>
<p class="p1"><span class="Apple-converted-space">  </span>gridWrap.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>gridWrap.appendChild(view);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function renderStaircase(entries, total, type, goalId){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const wrap = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrap.className = 'stairwrap';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const tileSize = 50, gap = 6;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const count = type==='finite' ? (total ?? 0) : entries.length;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const sorted = entries.slice().sort(byDateAsc);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// dynamic canvas size for long staircases</p>
<p class="p1"><span class="Apple-converted-space">  </span>const needed = (count-1) * (tileSize+gap) + tileSize + 16;</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrap.style.minHeight = Math.max(420, needed) + 'px';</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrap.style.minWidth<span class="Apple-converted-space">  </span>= Math.max(320, needed) + 'px';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>for(let i=0;i&lt;count;i++){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const entry = sorted[i];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const tile = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">    </span>tile.className = 'tile' + (entry ? ' done' : '');</p>
<p class="p1"><span class="Apple-converted-space">    </span>tile.style.left <span class="Apple-converted-space">  </span>= (i * (tileSize + gap)) + 'px';</p>
<p class="p1"><span class="Apple-converted-space">    </span>tile.style.bottom = (i * (tileSize + gap)) + 'px';</p>
<p class="p1"><span class="Apple-converted-space">    </span>tile.setAttribute('title', entry ? `[${entry.date}] ${entry.note || ''}` : 'Not yet');</p>
<p class="p1"><span class="Apple-converted-space">    </span>tile.innerHTML = `&lt;span class="label"&gt;${entry ? shortDate(entry.date) : ''}&lt;/span&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(entry){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const btn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">      </span>btn.ariaLabel = `Edit entry for ${entry.date}`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>btn.addEventListener('click', ()=&gt; openEntryDialog(goalId, entry.id));</p>
<p class="p1"><span class="Apple-converted-space">      </span>tile.appendChild(btn);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrap.appendChild(tile);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>return wrap;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/* ========= Helpers ========= */</p>
<p class="p1">function escapeHTML(str=''){ return String(str).replace(/[&amp;&lt;&gt;"']/g, s=&gt;({ '&amp;':'&amp;amp;','&lt;':'&amp;lt;','&gt;':'&amp;gt;','"':'&amp;quot;',"'":'&amp;#39;' }[s])) }</p>
<p class="p1">function calcStreak(dates){</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!dates.length) return 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const set = new Set(dates);</p>
<p class="p1"><span class="Apple-converted-space">  </span>let streak = 0; let cur = todayLocalISO();</p>
<p class="p1"><span class="Apple-converted-space">  </span>while(set.has(cur)){ streak++; cur = prevDay(cur); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>return streak;</p>
<p class="p1">}</p>
<p class="p1">function prevDay(iso){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [y,m,d] = iso.split('-').map(Number);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const dt = new Date(y, m-1, d-1);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const yy = dt.getFullYear(), mm = String(dt.getMonth()+1).padStart(2,'0'), dd = String(dt.getDate()).padStart(2,'0');</p>
<p class="p1"><span class="Apple-converted-space">  </span>return `${yy}-${mm}-${dd}`;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/* ========= Modals &amp; Actions ========= */</p>
<p class="p1">const supportsDialog = typeof HTMLDialogElement !== 'undefined';</p>
<p class="p1">const goalDialog = $('#goalDialog'), goalForm = $('#goalForm');</p>
<p class="p1">const noteDialog = $('#noteDialog'), noteForm = $('#noteForm');</p>
<p class="p1">const entryDialog = $('#entryDialog'), entryForm = $('#entryForm');</p>
<p class="p1">let editingGoalId = null;</p>
<p class="p1">let editingEntry = { goalId:null, entryId:null };</p>
<p class="p2"><br></p>
<p class="p1">$('#newGoalBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!supportsDialog){</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Fallback: quick prompts</p>
<p class="p1"><span class="Apple-converted-space">    </span>const type = confirm('OK = Visible end goal\nCancel = No end goal') ? 'finite' : 'infinite';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const name = prompt('Goal name (e.g. Walk 7,500):','')?.trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!name) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let total;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(type==='finite'){</p>
<p class="p1"><span class="Apple-converted-space">      </span>total = Number(prompt('Total stairs (e.g. 100):','100'));</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(!total || total &lt; 1) total = 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>const g = { id:uid(), name, type, total:type==='finite'? total:undefined, entries:[], createdAt:todayLocalISO() };</p>
<p class="p1"><span class="Apple-converted-space">    </span>state.goals.unshift(g); state.activeId = g.id; save(); fullRender();</p>
<p class="p1"><span class="Apple-converted-space">    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>editingGoalId = null;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#goalDialogTitle').textContent = 'Create goal';</p>
<p class="p1"><span class="Apple-converted-space">  </span>goalForm.reset();</p>
<p class="p1"><span class="Apple-converted-space">  </span>toggleTotalRow();</p>
<p class="p1"><span class="Apple-converted-space">  </span>goalDialog.showModal();</p>
<p class="p1">});</p>
<p class="p1">$('#editGoalBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>const g = state.goals.find(x=&gt;x.id===state.activeId); if(!g) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!supportsDialog){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const name = prompt('Rename goal:', g.name)?.trim(); if(!name) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>g.name = name;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(g.type==='finite'){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const n = Number(prompt('Total stairs:', String(g.total ?? 1)));</p>
<p class="p1"><span class="Apple-converted-space">      </span>g.total = (!n || n&lt;1) ? 1 : n;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>save(); fullRender(); return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>editingGoalId = g.id;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#goalDialogTitle').textContent = 'Edit goal';</p>
<p class="p1"><span class="Apple-converted-space">  </span>goalForm.elements['name'].value = g.name;</p>
<p class="p1"><span class="Apple-converted-space">  </span>for(const r of goalForm.elements['type']) r.checked = r.value === g.type;</p>
<p class="p1"><span class="Apple-converted-space">  </span>goalForm.elements['total'].value = g.total ?? '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>toggleTotalRow();</p>
<p class="p1"><span class="Apple-converted-space">  </span>goalDialog.showModal();</p>
<p class="p1">});</p>
<p class="p1">function toggleTotalRow(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const type = [...goalForm.elements['type']].find(r=&gt;r.checked)?.value;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#totalRow').style.display = type==='finite' ? '' : 'none';</p>
<p class="p1">}</p>
<p class="p1">goalForm.addEventListener('change', toggleTotalRow);</p>
<p class="p1">goalForm.addEventListener('submit', (e)=&gt; e.preventDefault());</p>
<p class="p1">goalDialog.addEventListener('close', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(goalDialog.returnValue !== 'ok') return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const form = new FormData(goalForm);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const type = form.get('type') === 'infinite' ? 'infinite' : 'finite';</p>
<p class="p1"><span class="Apple-converted-space">  </span>const name = String(form.get('name')||'').trim();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const totalRaw = form.get('total');</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!name) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>if(editingGoalId){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const g = state.goals.find(x=&gt;x.id===editingGoalId); if(!g) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>g.name = name; g.type = type;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(type==='finite'){ g.total = Math.max(1, Number(totalRaw||0)); } else { delete g.total; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const g = { id:uid(), name, type, total:type==='finite'? Math.max(1, Number(totalRaw||0)) : undefined, entries:[], createdAt:todayLocalISO() };</p>
<p class="p1"><span class="Apple-converted-space">    </span>state.goals.unshift(g); state.activeId = g.id;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>save(); fullRender();</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">$('#deleteGoalBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>const g = state.goals.find(x=&gt;x.id===state.activeId); if(!g) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(confirm(`Delete goal "${g.name}"? This cannot be undone.`)){</p>
<p class="p1"><span class="Apple-converted-space">    </span>state.goals = state.goals.filter(x=&gt;x.id!==g.id);</p>
<p class="p1"><span class="Apple-converted-space">    </span>state.activeId = state.goals[0]?.id ?? null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>save(); fullRender();</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">$('#logTodayBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>const g = state.goals.find(x=&gt;x.id===state.activeId); if(!g) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const today = todayLocalISO();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const exists = g.entries.some(e=&gt;e.date===today);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!supportsDialog){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const note = prompt(`${exists?'Update':'Add'} note for ${fmt(today)}:` , exists? (g.entries.find(e=&gt;e.date===today)?.note || '') : '');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(note===null) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ex = g.entries.find(e=&gt;e.date===today);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(ex){ ex.note = note.trim(); } else { g.entries.push({ id:uid(), date:today, note:note.trim() }); g.entries.sort(byDateAsc); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>save(); fullRender(); return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#noteTitle').textContent = exists ? 'Update today’s step' : 'Today’s step';</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#noteDate').textContent = fmt(today);</p>
<p class="p1"><span class="Apple-converted-space">  </span>noteForm.elements['note'].value = exists ? (g.entries.find(e=&gt;e.date===today)?.note ?? '') : '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>noteDialog.showModal();</p>
<p class="p1">});</p>
<p class="p1">noteForm.addEventListener('submit', e=&gt; e.preventDefault());</p>
<p class="p1">noteDialog.addEventListener('close', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>const g = state.goals.find(x=&gt;x.id===state.activeId); if(!g) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(noteDialog.returnValue !== 'ok') return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const note = String(new FormData(noteForm).get('note')||'').trim();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const today = todayLocalISO();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const ex = g.entries.find(e=&gt;e.date===today);</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(ex){ ex.note = note; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>else { g.entries.push({ id: uid(), date: today, note }); g.entries.sort(byDateAsc); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>save(); fullRender();</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">function openEntryDialog(goalId, entryId){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const g = state.goals.find(x=&gt;x.id===goalId); if(!g) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const e = g.entries.find(x=&gt;x.id===entryId); if(!e) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!supportsDialog){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const note = prompt(`Edit note for ${fmt(e.date)}:`, e.note || '');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(note===null) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(note==='__delete__'){ g.entries = g.entries.filter(x=&gt;x.id!==entryId); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else { e.note = note.trim(); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>save(); fullRender(); return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#entryDate').textContent = fmt(e.date);</p>
<p class="p1"><span class="Apple-converted-space">  </span>entryForm.elements['note'].value = e.note || '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>editingEntry = { goalId, entryId };</p>
<p class="p1"><span class="Apple-converted-space">  </span>entryDialog.showModal();</p>
<p class="p1">}</p>
<p class="p1">entryForm.addEventListener('submit', ev=&gt; ev.preventDefault());</p>
<p class="p1">$('#deleteEntryBtn').addEventListener('click', (ev)=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>ev.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const {goalId, entryId} = editingEntry; if(!goalId) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const g = state.goals.find(x=&gt;x.id===goalId); if(!g) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>g.entries = g.entries.filter(e=&gt;e.id!==entryId);</p>
<p class="p1"><span class="Apple-converted-space">  </span>save(); entryDialog.close(); fullRender();</p>
<p class="p1">});</p>
<p class="p1">entryDialog.addEventListener('close', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(entryDialog.returnValue !== 'ok') return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const {goalId, entryId} = editingEntry; if(!goalId) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const g = state.goals.find(x=&gt;x.id===goalId); if(!g) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const e = g.entries.find(x=&gt;x.id===entryId); if(!e) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>e.note = String(new FormData(entryForm).get('note')||'').trim();</p>
<p class="p1"><span class="Apple-converted-space">  </span>save(); fullRender();</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">/* ========= Export / Import / Reset ========= */</p>
<p class="p1">$('#exportBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});</p>
<p class="p1"><span class="Apple-converted-space">  </span>const url = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const a = document.createElement('a'); a.href = url; a.download = `steps-export-${todayLocalISO()}.json`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=&gt; URL.revokeObjectURL(url), 500);</p>
<p class="p1">});</p>
<p class="p1">$('#importFile').addEventListener('change', (e)=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>const file = e.target.files[0]; if(!file) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const reader = new FileReader();</p>
<p class="p1"><span class="Apple-converted-space">  </span>reader.onload = ()=&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>try{</p>
<p class="p1"><span class="Apple-converted-space">      </span>const data = JSON.parse(String(reader.result));</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(!data || !Array.isArray(data.goals)) throw new Error('Invalid file');</p>
<p class="p1"><span class="Apple-converted-space">      </span>state = data; save(); fullRender(); alert('Import successful.');</p>
<p class="p1"><span class="Apple-converted-space">    </span>} catch{ alert('Could not import this file.'); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>e.target.value = '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p1"><span class="Apple-converted-space">  </span>reader.readAsText(file);</p>
<p class="p1">});</p>
<p class="p1">$('#clearAllBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(confirm('Delete ALL goals and entries?')){ state = { goals: [], activeId: null }; save(); fullRender(); }</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">/* ========= Init ========= */</p>
<p class="p1">function fullRender(){ renderGoals(); renderDetail(); }</p>
<p class="p1">load(); renderToday(); fullRender();</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
